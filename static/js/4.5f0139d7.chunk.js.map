{"version":3,"sources":["components/AddTenancy.tsx"],"names":["AddTenancy","hideModal","t","useTranslation","dispatch","useContext","TenancyContext","is_mounted","useRef","useEffect","current","useState","is_loading","setIsLoading","is_saving","setIsSaving","picked_tenancy","setPickedTenancy","options","setOptions","show","onHide","onSubmit","event","preventDefault","stopPropagation","addTenancyToStorage","then","data","type","ADD_TENANCY","payload","catch","err","console","log","Header","closeButton","Title","Body","filterBy","id","isLoading","labelKey","minLength","onSearch","query","getAddressInfoFromDAWA","success","fail","onChange","pick","placeholder","renderMenuItemChildren","option","tekst","Footer","variant","onClick","disabled","animation","role","size","className"],"mappings":"2MA8HeA,UA9GI,SAAC,GAAoC,IAAlCC,EAAiC,EAAjCA,UACZC,EAAMC,cAAND,EACAE,EAAaC,qBAAWC,KAAxBF,SAEFG,EAAaC,kBAAO,GAE1BC,qBAAU,WAER,OADAF,EAAWG,SAAU,EACd,WACLH,EAAWG,SAAU,KAEtB,IAXkD,MAalBC,oBAAS,GAbS,mBAa9CC,EAb8C,KAalCC,EAbkC,OAcpBF,oBAAS,GAdW,mBAc9CG,EAd8C,KAcnCC,EAdmC,OAgBVJ,qBAhBU,mBAgB9CK,EAhB8C,KAgB9BC,EAhB8B,OAiBvBN,mBAAoB,IAjBG,mBAiB9CO,EAjB8C,KAiBrCC,EAjBqC,KAiErD,OACE,cAAC,IAAD,CAAOC,MAAM,EAAMC,OAAQpB,EAA3B,SACE,eAAC,IAAD,CAAMqB,SA7BW,SAACC,GACpBA,EAAMC,iBACND,EAAME,kBACFT,IACFD,GAAY,GACZW,YAAoBV,GACjBW,MAAK,SAACC,GACLxB,EAAS,CACPyB,KAAMC,IACNC,QAASH,IAEPrB,EAAWG,UACbK,GAAY,GACZd,QAGH+B,OAAM,SAACC,GACF1B,EAAWG,SACbK,GAAY,GAEdmB,QAAQC,IAAIF,QAShB,UACE,cAAC,IAAMG,OAAP,CAAcC,aAAW,EAAzB,SACE,cAAC,IAAMC,MAAP,UAAcpC,EAAE,+BAElB,eAAC,IAAMqC,KAAP,WACGrC,EAAE,qCACH,cAAC,IAAD,CACEsC,SAXO,kBAAM,GAYbC,GAAG,kBACHC,UAAW9B,EACX+B,SAAS,QACTC,UAAW,EACXC,SA5DW,SAACC,GACpBjC,GAAa,GACbkC,YAAuB,CACrBD,QACAE,QAAS,SAACpB,GACRT,EAAWS,GACXf,GAAa,IAEfoC,KAAM,SAAChB,GACLpB,GAAa,GACbqB,QAAQC,IAAIF,OAmDRiB,SA9CgB,SAACC,GACzBlC,EAAiBkC,EAAK,KA8CdjC,QAASA,EACTkC,YAAalD,EAAE,iCACfmD,uBAAwB,SAACC,GAAD,OAAqB,+BAAOA,EAAOC,cAG/D,eAAC,IAAMC,OAAP,WACE,cAAC,IAAD,CAAQC,QAAQ,YAAYC,QAASzD,EAArC,SACGC,EAAE,+BAEL,eAAC,IAAD,CACEuD,QAASzC,EAAiB,UAAY,YACtCa,KAAK,SACL8B,UAAW3C,GAAkBF,EAH/B,UAKGA,GACC,qCACE,cAAC,IAAD,CAAS8C,UAAU,SAASC,KAAK,SAASC,KAAK,KAA/C,SACE,sBAAMC,UAAU,UAAhB,0BACS,IACV7D,EAAE,yCAGLY,GAAaZ,EAAE","file":"static/js/4.5f0139d7.chunk.js","sourcesContent":["import React, { useState, useContext, useRef, useEffect } from 'react'\nimport Modal from 'react-bootstrap/Modal'\nimport Button from 'react-bootstrap/Button'\nimport Spinner from 'react-bootstrap/Spinner'\nimport Form from 'react-bootstrap/Form'\nimport { addTenancyToStorage, getAddressInfoFromDAWA } from '../lib/backend'\nimport { Tenancy } from '../types/global'\nimport { AsyncTypeahead } from 'react-bootstrap-typeahead'\nimport { ADD_TENANCY, TenancyContext } from '../contexts/TenancyContext'\n\nimport { useTranslation } from 'react-i18next'\n\ntype AddTenancyProps = {\n  hideModal: () => void\n}\n\nconst AddTenancy = ({ hideModal }: AddTenancyProps) => {\n  const { t } = useTranslation()\n  const { dispatch } = useContext(TenancyContext)\n\n  const is_mounted = useRef(false)\n\n  useEffect(() => {\n    is_mounted.current = true\n    return () => {\n      is_mounted.current = false\n    }\n  }, [])\n\n  const [is_loading, setIsLoading] = useState(false)\n  const [is_saving, setIsSaving] = useState(false)\n\n  const [picked_tenancy, setPickedTenancy] = useState<Tenancy>()\n  const [options, setOptions] = useState<Tenancy[]>([])\n\n  const handleSearch = (query: string) => {\n    setIsLoading(true)\n    getAddressInfoFromDAWA({\n      query,\n      success: (data) => {\n        setOptions(data)\n        setIsLoading(false)\n      },\n      fail: (err) => {\n        setIsLoading(false)\n        console.log(err)\n      },\n    })\n  }\n\n  const handleTenancyPick = (pick: Tenancy[]) => {\n    setPickedTenancy(pick[0])\n  }\n\n  const handleSubmit = (event: React.FormEvent<HTMLFormElement>): void => {\n    event.preventDefault()\n    event.stopPropagation()\n    if (picked_tenancy) {\n      setIsSaving(true)\n      addTenancyToStorage(picked_tenancy)\n        .then((data) => {\n          dispatch({\n            type: ADD_TENANCY,\n            payload: data,\n          })\n          if (is_mounted.current) {\n            setIsSaving(false)\n            hideModal()\n          }\n        })\n        .catch((err) => {\n          if (is_mounted.current) {\n            setIsSaving(false)\n          }\n          console.log(err)\n        })\n    }\n  }\n\n  const filterBy = () => true\n\n  return (\n    <Modal show={true} onHide={hideModal}>\n      <Form onSubmit={handleSubmit}>\n        <Modal.Header closeButton>\n          <Modal.Title>{t('add_tenancy_modal_title')}</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          {t('add_tenancy_start_typing_to_fetch')}\n          <AsyncTypeahead\n            filterBy={filterBy}\n            id=\"async-tenancies\"\n            isLoading={is_loading}\n            labelKey=\"tekst\"\n            minLength={3}\n            onSearch={handleSearch}\n            onChange={handleTenancyPick}\n            options={options}\n            placeholder={t('add_tenancy_fetch_placeholder')}\n            renderMenuItemChildren={(option: Tenancy) => <span>{option.tekst}</span>}\n          />\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"secondary\" onClick={hideModal}>\n            {t('add_tenancy_cancel_button')}\n          </Button>\n          <Button\n            variant={picked_tenancy ? 'primary' : 'secondary'}\n            type=\"submit\"\n            disabled={!picked_tenancy || is_saving}\n          >\n            {is_saving && (\n              <>\n                <Spinner animation=\"border\" role=\"status\" size=\"sm\">\n                  <span className=\"sr-only\">Loading...</span>\n                </Spinner>{' '}\n                {t('add_tenancy_save_button_is_saving')}\n              </>\n            )}\n            {!is_saving && t('add_tenancy_save_button')}\n          </Button>\n        </Modal.Footer>\n      </Form>\n    </Modal>\n  )\n}\nexport default AddTenancy\n"],"sourceRoot":""}