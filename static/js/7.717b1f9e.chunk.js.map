{"version":3,"sources":["components/portfolio/EditTenancy.tsx","components/portfolio/TenancyDetails.tsx","components/portfolio/Tenancy.tsx"],"names":["EditTenancy","tenancy","success","useAlert","is_mounted","useRef","t","useTranslation","dispatch","useContext","TenancyContext","useState","is_saving","setIsSaving","size","nbr_of_rooms","tenant_information","utilities","useForm","defaultValues","handleSubmit","register","formState","reset","isDirty","isValid","useEffect","current","Form","onSubmit","form_data","post","id","db_id","data","updateTenancyInStorage","then","updated_tenancy","type","UPDATE_TENANCY","payload","catch","err","console","log","Group","controlId","Label","Control","step","placeholder","defaultValue","as","rows","Button","variant","disabled","Spinner","animation","role","ItemContainer","styled","Container","TenancyDetails","item","url","y","x","process","user","AuthContext","is_deleting","setIsDeleting","navigate","useNavigate","Row","Col","tekst","lg","Image","crossOrigin","width","src","rounded","onClick","window","confirm","deleteTenancyFromStorage","DELETE_TENANCY","MyCrumb","Breadcrumb","Tenancy","useParams","tenancies","setItem","error","setError","filter","obj","Item","linkAs","Link","linkProps","to","active"],"mappings":"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","file":"static/js/7.717b1f9e.chunk.js","sourcesContent":["import React, { useState, useContext, useRef, useEffect } from 'react'\nimport Button from 'react-bootstrap/Button'\nimport Spinner from 'react-bootstrap/Spinner'\nimport Form from 'react-bootstrap/Form'\nimport { updateTenancyInStorage } from '../../lib/storage'\nimport { Tenancy, DB_ID } from '../../types/global'\nimport { UPDATE_TENANCY, TenancyContext } from '../../contexts/TenancyContext'\nimport { useForm } from 'react-hook-form'\nimport { useAlert } from 'react-bootstrap-hooks-alert'\n\nimport { useTranslation } from 'react-i18next'\n\ntype FormData = {\n  size: number\n  nbr_of_rooms: number\n  utilities: string\n  tenant_information: string\n}\n\ntype EditTenancyProps = {\n  tenancy: Tenancy\n}\n\nconst EditTenancy = ({ tenancy }: EditTenancyProps) => {\n  const { success } = useAlert()\n  const is_mounted = useRef(false)\n  const { t } = useTranslation()\n  const { dispatch } = useContext(TenancyContext)\n  const [is_saving, setIsSaving] = useState(false)\n\n  const { size, nbr_of_rooms, tenant_information, utilities } = tenancy\n\n  const { handleSubmit, register, formState, reset } = useForm<FormData>({\n    defaultValues: { size, nbr_of_rooms, tenant_information, utilities },\n  })\n\n  // otherwise isDirty and isValid are not updated...\n  const { isDirty, isValid } = formState\n\n  useEffect(() => {\n    is_mounted.current = true\n    return () => {\n      is_mounted.current = false\n    }\n  }, [])\n\n  const onSubmit = (form_data: FormData) => {\n    // console.log('FormData', form_data)\n    setIsSaving(true)\n\n    const post = {\n      id: tenancy.db_id as DB_ID,\n      data: form_data,\n      // user,\n    }\n\n    updateTenancyInStorage(post)\n      .then((data) => {\n        reset(form_data) // so the form is no longer dirty\n        const updated_tenancy: Tenancy = { ...tenancy, ...data }\n        dispatch({\n          type: UPDATE_TENANCY,\n          payload: updated_tenancy,\n        })\n        success(t('edit_tenancy_saved_confirmation'))\n\n        if (is_mounted.current) {\n          setIsSaving(false)\n        }\n      })\n      .catch((err) => {\n        if (is_mounted.current) {\n          setIsSaving(false)\n        }\n        console.log(err)\n      })\n  }\n\n  return (\n    <Form onSubmit={handleSubmit(onSubmit)}>\n      <Form.Group controlId=\"formBasicSize\">\n        <Form.Label>{t('edit_tenancy_label_size')}</Form.Label>\n        <Form.Control\n          {...register('size')}\n          type=\"number\"\n          step=\"0.1\"\n          placeholder={t('edit_tenancy_label_size_placeholder')}\n        />\n      </Form.Group>\n\n      <Form.Group controlId=\"formBasicNbrOfRooms\">\n        <Form.Label>{t('edit_tenancy_label_nbr_of_rooms')}</Form.Label>\n        <Form.Control\n          {...register('nbr_of_rooms')}\n          defaultValue={tenancy && tenancy.nbr_of_rooms}\n          type=\"number\"\n          step=\"1\"\n          placeholder={t('edit_tenancy_label_nbr_of_rooms_placeholder')}\n        />\n      </Form.Group>\n\n      <Form.Group controlId=\"formBasicUtilities\">\n        <Form.Label>{t('edit_tenancy_label_utilities')}</Form.Label>\n        <Form.Control\n          {...register('utilities')}\n          defaultValue={tenancy && tenancy.utilities}\n          as=\"textarea\"\n          rows={3}\n          placeholder={t('edit_tenancy_label_utilities_placeholder')}\n        />\n      </Form.Group>\n\n      <Form.Group controlId=\"formBasicTenantInformation\">\n        <Form.Label>{t('edit_tenancy_label_tenant_information')}</Form.Label>\n        <Form.Control\n          {...register('tenant_information')}\n          defaultValue={tenancy && tenancy.tenant_information}\n          as=\"textarea\"\n          rows={3}\n          placeholder={t('edit_tenancy_label_tenant_information_placeholder')}\n        />\n      </Form.Group>\n      <Button variant=\"primary\" type=\"submit\" disabled={!isDirty || !isValid}>\n        {is_saving && (\n          <>\n            <Spinner animation=\"border\" role=\"status\" size=\"sm\"></Spinner> {t('edit_tenancy_save_button_is_saving')}\n          </>\n        )}\n        {!is_saving && t('edit_tenancy_save_button')}\n      </Button>\n    </Form>\n  )\n}\nexport default EditTenancy\n","import React, { useContext, useEffect, useState, useRef } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { TenancyContext, DELETE_TENANCY } from 'contexts/TenancyContext'\nimport { Tenancy as TenancyType, DB_ID } from 'types/global'\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row'\nimport Col from 'react-bootstrap/Col'\nimport Button from 'react-bootstrap/Button'\nimport Spinner from 'react-bootstrap/Spinner'\nimport { XLg } from 'react-bootstrap-icons'\nimport { useTranslation } from 'react-i18next'\nimport { useAlert } from 'react-bootstrap-hooks-alert'\n\nimport Image from 'react-bootstrap/Image'\n\nimport EditTenancy from './EditTenancy'\nimport styled from '@emotion/styled'\nimport { deleteTenancyFromStorage } from 'lib/storage'\nimport { AuthContext } from 'contexts/AuthContext'\n\nconst ItemContainer = styled(Container)`\n  img {\n    max-width: 85vw;\n  }\n  margin-bottom: 40px;\n`\n\ntype TenancyDetailsProps = {\n  item: TenancyType\n}\n\nconst TenancyDetails = ({ item }: TenancyDetailsProps) => {\n  const url =\n    process.env.NODE_ENV === 'production'\n      ? `https://maps.googleapis.com/maps/api/streetview?size=400x400&location=${item.y},${item.x}&fov=70&pitch=0&key=${process.env.REACT_APP_GOOGLE_API_KEY}`\n      : `https://via.placeholder.com/500`\n  const { t } = useTranslation()\n  const { success } = useAlert()\n  const { user } = useContext(AuthContext)\n\n  const [is_deleting, setIsDeleting] = useState(false)\n\n  const { dispatch } = useContext(TenancyContext)\n  const navigate = useNavigate()\n\n  const is_mounted = useRef(false)\n\n  useEffect(() => {\n    is_mounted.current = true\n    return () => {\n      is_mounted.current = false\n    }\n  }, [])\n\n  /**\n   * @todo make it purdier than window.confirm\n   */\n  const handleDeleteClick = () => {\n    setIsDeleting(true)\n    if (window.confirm('Are you sure?')) {\n      deleteTenancyFromStorage(item.db_id as DB_ID, user)\n        .then(() => {\n          dispatch({\n            type: DELETE_TENANCY,\n            payload: item.id,\n          })\n          success(t('tenancy_was_deleted_confirmation'))\n          navigate('tenancies')\n\n          if (is_mounted.current) {\n            setIsDeleting(false)\n          }\n        })\n        .catch((err) => {\n          setIsDeleting(false)\n          console.log(err)\n        })\n    } else {\n      setIsDeleting(false)\n    }\n  }\n\n  return (\n    <ItemContainer>\n      <Row>\n        <Col>\n          <h1>{item.tekst}</h1>\n        </Col>\n      </Row>\n      <Row>\n        <Col lg>\n          <Image\n            crossOrigin={process.env.NODE_ENV === 'production' ? 'anonymous' : undefined}\n            width=\"500\"\n            src={url}\n            rounded\n          />\n        </Col>\n        <Col lg>\n          <EditTenancy tenancy={item} />\n        </Col>\n      </Row>\n      <Row>\n        <Col>\n          <br />\n          <Button variant=\"danger\" onClick={handleDeleteClick}>\n            {is_deleting && (\n              <>\n                <Spinner animation=\"border\" role=\"status\" size=\"sm\"></Spinner>{' '}\n                {t('edit_tenancy_delete_button_is_deleting')}\n              </>\n            )}\n            {!is_deleting && (\n              <>\n                <XLg /> {t('edit_tenancy_delete_button')}\n              </>\n            )}\n          </Button>\n        </Col>\n      </Row>\n    </ItemContainer>\n  )\n}\n\nexport default TenancyDetails\n","import React, { useContext, useEffect, useState } from 'react'\nimport { Link, useParams } from 'react-router-dom'\nimport { TenancyContext } from 'contexts/TenancyContext'\nimport { Tenancy as TenancyType } from 'types/global'\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row'\nimport Col from 'react-bootstrap/Col'\nimport Breadcrumb from 'react-bootstrap/Breadcrumb'\nimport { useTranslation } from 'react-i18next'\n\nimport styled from '@emotion/styled'\nimport TenancyDetails from './TenancyDetails'\n\nconst MyCrumb = styled(Breadcrumb)`\n  ol {\n    background-color: transparent;\n  }\n`\n\nconst Tenancy = () => {\n  const { id } = useParams()\n  const { t } = useTranslation()\n  const { tenancies } = useContext(TenancyContext)\n\n  const [item, setItem] = useState<TenancyType | null>(null)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    const item = tenancies.filter((obj) => obj.id === id)[0]\n    if (item) {\n      setError('')\n      setItem(item)\n    } else {\n      setItem(null)\n      setError('Item not found :(')\n    }\n  }, [tenancies, id])\n\n  return (\n    <>\n      <MyCrumb>\n        <Breadcrumb.Item linkAs={Link} linkProps={{ to: '/' }}>\n          {t('tenancy_item_breadcrumb_back_to_list')}\n        </Breadcrumb.Item>\n        <Breadcrumb.Item active>\n          {error && 'ERROR'}\n          {item && item.tekst}\n        </Breadcrumb.Item>\n      </MyCrumb>\n      {error && (\n        <Container>\n          <Row>\n            <Col>{error}</Col>\n          </Row>\n        </Container>\n      )}\n      {item && <TenancyDetails item={item} />}\n    </>\n  )\n}\nexport default Tenancy\n"],"sourceRoot":""}